backend:
  image: "senseibird-backend:1.0.0"
  replicas: 1
  port: 8000

frontend:
  image: "senseibird-frontend:1.0.2"
  replicas: 1
  port: 3000

resources:
  limits:
    cpu: "200m"
    memory: "256Mi"
  requests:
    cpu: "100m"
    memory: "128Mi"

config:
  DATABASE_URL: "sqlite:///app.db"

monitoring:
  enabled: true
  namespace: monitoring
  prometheus:
    enabled: true
    image: prom/prometheus:v2.52.0
    nodePort: 30900
    config: |
      global:
        scrape_interval: 15s

      scrape_configs:
        - job_name: "prometheus"
          static_configs:
            - targets: ["localhost:9090"]

        - job_name: "senseibird-api"
          metrics_path: /metrics
          static_configs:
            - targets:
                - "senseibird-api.senseibird.svc.cluster.local:8000"

        - job_name: "kubelet"
          scheme: https
          kubernetes_sd_configs:
            - role: node
          bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
          tls_config:
            ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          relabel_configs:
            - action: labelmap
              regex: __meta_kubernetes_node_label_(.+)
            - target_label: __address__
              replacement: kubernetes.default.svc:443
            - source_labels: [__meta_kubernetes_node_name]
              target_label: __metrics_path__
              replacement: /api/v1/nodes/$1/proxy/metrics

        - job_name: "kubelet-cadvisor"
          scheme: https
          kubernetes_sd_configs:
            - role: node
          bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
          tls_config:
            ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          relabel_configs:
            - action: labelmap
              regex: __meta_kubernetes_node_label_(.+)
            - target_label: __address__
              replacement: kubernetes.default.svc:443
            - source_labels: [__meta_kubernetes_node_name]
              target_label: __metrics_path__
              replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
  grafana:
    enabled: true
    image: grafana/grafana:10.4.2
    nodePort: 32000
    adminUser: admin
    adminPassword: superSecret123
    datasourceUrl: http://prometheus.monitoring.svc.cluster.local:9090
